const spikip=(()=>{const a={},[b,c,d,e,f]=[new WeakMap,new WeakMap,new WeakMap,new WeakMap,new Map],g=new Set(["focus","blur","scroll","load","error"]),h=new Set;let i,j,k=Promise.resolve();const l=(a,b)=>a.getAttribute(b),m=a=>f.get(a)||f.set(a,a.split(".")).get(a),n=(a,b)=>b.includes(".")?m(b).reduce((a,b)=>a?.[b],a):a[b],o=a=>!h.has(a)&&h.add(a)&&!j&&(j=!0)&&k.then(()=>(h.forEach(a=>a()),h.clear(),j=!1)),p=(a,b)=>new Proxy(a,{get:(a,c,d)=>"el"===c?b:Reflect.get(a,c,d),set:(a,b,c,d)=>Reflect.set(a,b,c,d)}),q=(a,b)=>{if(!i)return;let c=e.get(a);c||e.set(a,c=new Map);let d=c.get(b);d||c.set(b,d=new Set),d.add(i),i.deps.push(d)},s=(a,b)=>{const c=e.get(a)?.get(b);c&&[...c].forEach(a=>a.scheduler?a.scheduler(a):a())},t=a=>(a.deps.forEach(b=>b.delete(a)),a.deps.length=0),u=(a,b={})=>{const c=()=>{t(c),i=c;try{a()}finally{i=null}};return c.deps=[],c.scheduler=b.scheduler,c(),()=>t(c)},v=a=>{if(!a||"object"!=typeof a||a instanceof Node)return a;if(d.has(a))return d.get(a);const b=new Proxy(a,{get(a,b,c){q(a,b);const d=Reflect.get(a,b,c);return"object"==typeof d&&d?v(d):d},set(a,b,c,d){const e=a[b],f=Reflect.set(a,b,c,d);return e!==c&&(s(a,b),Array.isArray(a)&&!isNaN(b)&&s(a,"length")),f}});return d.set(a,b),b},w={text:(a,b)=>a.textContent=b??"",html:(a,b)=>a.innerHTML=b??"",value:(a,b)=>{"checkbox"===a.type?a.checked=!!b:"radio"===a.type?a.checked=a.name?a.value===b+"":!!b:a.value!==(b??"")+""&&(a.value=b??"")},props:(a,b,c)=>"boolean"==typeof a[c]?a[c]=!!b:null==b||!1===b?a.removeAttribute(c):a.setAttribute(c,b),class:(a,b,c)=>a.classList.toggle(c,!!b)},x=d=>{if(d._isMounted)return;d._isMounted=!0;const e=l(d,"data-func"),f=a[e];if(!f)return;const h=f({computed:a=>{const c=v({value:void 0});return u(()=>c.value=a()),c}});if(!h||"object"!=typeof h)return;const i=v(h),j=[],k=new Set;h.refs={},h.root=d;const m=a=>{for(let e=a.target;e&&e!==d.parentNode;){const d=c.get(e);if(d?.[a.type]){const c=b.get(e);if(c){const b=n(c,d[a.type]);if("function"==typeof b){let d=!1;const f=a.stopPropagation.bind(a);Object.defineProperty(a,"stopPropagation",{value:()=>(f(),d=!0),configurable:!0});try{b.call(p(c,e),a)}catch(a){console.error(a)}if(d)return}}}e=e.parentNode}},q=(a,b)=>b?.push(u(a,{scheduler:o})),r=(e,a,f)=>{let h,j;if(!e.hasAttribute("data-static")&&!(e!==d&&e.hasAttribute("data-func"))){if(h=l(e,"data-if")){const b=document.createTextNode("");e.parentNode.insertBefore(b,e),e.remove();let c,d;return void q(()=>{if(!n(a,h))c&&d();else if(!c){c=e.cloneNode(!0),c.removeAttribute("data-if");const f=[];r(c,a,f),d=()=>(f.forEach(a=>a()),c.remove(),c=null),b.parentNode.insertBefore(c,b)}},f)}if(h=l(e,"data-bind")){b.set(e,a);const f=c.get(e)||{};let i=!1;h.split(" ").filter(Boolean).forEach(c=>{if(c.includes(":")){const[a,b]=c.split(":").map(a=>a.trim());k.has(a)||(d.addEventListener(a,m,g.has(a)),k.add(a)),f[a]=b,i=!0}else{const b=n(a,c);"function"==typeof b&&b.call(p(a,e))}}),i&&c.set(e,f)}if("TEMPLATE"===e.tagName&&(h=l(e,"data-loop"))&&(j=h.match(/\(?\s*(\w+)(?:,\s*(\w+))?\)?\s+in\s+(\S+)/))){const[b,c,d,g]=j,h=l(e,"data-key"),i=document.createTextNode("");e.parentNode.insertBefore(i,e),e.remove();let k=new Map;return void q(()=>{const b=n(a,g);if(!Array.isArray(b))return;b.length;const f=new Map;let j=i;for(let g=b.length-1;0<=g;g--){const l=b[g],m=h?n({[c]:l},h):g;let o=k.get(m);const p={[c]:l,...(d?{[d]:g}:{})};if(o)Object.assign(o.scope,p);else{const b=e.content.cloneNode(!0),c=v(p),d=new Proxy(c,{get:(b,c,d)=>c in b?Reflect.get(b,c,d):Reflect.get(a,c,d)}),f=[],g=Array.from(b.childNodes);(a=>{for(let b=a.firstElementChild;b;)r(b,d,f),b=b.nextElementSibling})(b),o={nodes:g,scope:d,cleanups:f}}o.nodes[o.nodes.length-1].nextSibling!==j&&o.nodes.forEach(a=>i.parentNode.insertBefore(a,j)),j=o.nodes[0],f.set(m,o)}k.forEach((a,b)=>{f.has(b)||(a.nodes.forEach(a=>a.remove()),a.cleanups.forEach(a=>a()))}),k=f},f)}(h=l(e,"data-ref"))&&(i.refs[h]=e),["text","html","value"].forEach(b=>{if(h=l(e,`data-${b}`)){const c=h.startsWith("*"),d=c?h.slice(1):h,g=()=>w[b](e,n(a,d));c?g():q(g,f)}}),["data-props:props","data-class:class"].forEach(b=>{const[c,d]=b.split(":");(h=l(e,c))&&h.split(",").forEach(b=>{const[c,g]=b.split(":").map(a=>a.trim());q(()=>w[d](e,n(a,g),c),f)})});for(let b=e.firstElementChild;b;)r(b,a,f),b=b.nextElementSibling}};return r(d,i,j),i.init&&i.init(),{unmount:()=>{d._isMounted=!1,k.forEach(a=>d.removeEventListener(a,m,g.has(a))),j.forEach(a=>a())}}};return{define:(b,c)=>a[b]=c,start:()=>document.querySelectorAll("[data-func]").forEach(x)}})();export default spikip;
